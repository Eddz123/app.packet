var express = require('express');var router = express.Router();const con = require('./connection');const main = require('./main');//==============================================================================================================//// URB TAB//==============================================================================================================//// GET APPLICATION PACKET TAB //router.get('/',(req,res,next)=>{  res.render('applicationpacket');});/* GET SPECIALIZATION TAB */router.get('/specialization', function(req, res, next) {  res.render('pages/specialization');});// GET THANK YOU PAGE TAB //router.get('/thankyou',(req,res,next)=>{  res.render('pages/thankyou');});//==============================================================================================================//// REGISTERED NURSE//==============================================================================================================//// FILL UP FORM FOR RN //router.get('/rn/startappform?',(req,res,next)=>{  if(!req.query.formid){    res.redirect('/applicationform/rn/startappform?formid='+ main.random_id());  }else{    res.render('pages/rn_pages/start', { title : 'Fillup Form', formid : req.query.formid});    res.end();  }});// VIEW REGISTERED NURSE FORM //router.get('/rn/viewform?',(req,res,next)=>{  if(req.session.email){    var id = req.query.id;    var q = `SELECT * FROM rn_information WHERE rn_id = ?`;    var qval = [id];    con.query(q,qval,(err,rs)=>{      if(err){        console.log("Err: "+ err);      }      var v = `UPDATE rn_information SET app_isview = ? WHERE rn_no = ?`;      var vVal = ['true', id];      con.query(v,vVal,(err1,rs1)=>{        if(err1){          console.log("Err: "+ err1);        }        var form_data = (typeof(rs[0].rn_otherinfo) === "undefined")? [] : JSON.parse(rs[0].rn_otherinfo);        var gf = `SELECT * FROM file_information WHERE file_no = ?`;        var gfval = [rs[0].rn_no];        con.query(gf,gfval,(err2, rs2)=>{          if (err){            throw err;          }          res.render('pages/rn_pages/view_start',{ title : 'View Applicant Form', app : form_data , filez : rs2});          res.end();        });      });    });  }else{    res.redirect('/users/login');    res.end();  }});// REGISTERED NURSE UPLOADER //router.post('/rn/upload-file?',(req,res,next)=>{  var no = req.query.formid;  if(!req.files || Object.keys(req.files).length === 0){    return res.status(400).send("No files were uploaded");  }  let file = req.files.resume;  var path = 'public/files/' + file.name;  file.mv(path, (err)=>{    if(err){      console.log("error: "+ err);    }    //Save data to Database    var q = `INSERT INTO files(file_no, file_name,file_path) VALUES ?`;    var qVal = [      [no, file.name, path]    ];    con.query(q,[qVal], (err,rs)=>{      if(err){        console.log("error: "+ err);      }      res.redirect("/applicationform/rn/startupform?formid="+ no);      res.end();    });  });});// SAVE FILL UP FORM RN //router.post('/rn/save-startappform?', function(req, res, next) {  var formid = req.query.formid;  var pg2name  = req.body.pg2name;  var pg2address = req.body.pg2address;  var pg2phonenumber = req.body.pg2phonenumber;  var pg2emailaddress = req.body.pg2emailaddress;  var pg2position = req.body.pg2position;  var form = JSON.stringify(req.body);  var query = 'INSERT INTO rn_information (rn_no,rn_name,rn_address,rn_phonenumber,rn_emailaddress,rn_positionapplied,rn_otherinfo) VALUES ?';  var queryval = [[formid,pg2name,pg2address,pg2phonenumber,pg2emailaddress,pg2position,form]];  con.query(query, [queryval], (err2, res2) => {    if (err2) {      throw err2    } else {      res.redirect('/applicationform/thankyou');    }  });});//==============================================================================================================//// LICENSED VOCATIONAL NURSE ( LVN FORM )//==============================================================================================================//// FILL UP FORM FOR LICENSED VOCATIONAL NURSE //router.get('/lvn/startappform?',(req,res,next)=>{  if(!req.query.formid){    res.redirect('/applicationform/lvn/startappform?formid='+ main.random_id());  }else{    res.render('pages/lvn_pages/start', { title : 'Fillup Form', formid : req.query.formid});    res.end();  }});// VIEW LICENSED VOCATIONAL NURSE FORM //router.get('/lvn/viewform?',(req,res,next)=>{  if(req.session.email){    var id = req.query.id;    var q = `SELECT * FROM lvn_information WHERE lvn_id = ?`;    var qval = [id];    con.query(q,qval,(err,rs)=>{      if(err){        console.log("Err: "+ err);      }      var v = `UPDATE lvn_information SET app_isview = ? WHERE lvn_no = ?`;      var vVal = ['true', id];      con.query(v,vVal,(err1,rs1)=>{        if(err1){          console.log("Err: "+ err1);        }        var form_data = (typeof(rs[0].lvn_otherinfo) === "undefined")? [] : JSON.parse(rs[0].lvn_otherinfo);        var gf = `SELECT * FROM file_information WHERE file_no = ?`;        var gfval = [rs[0].lvn_no];        con.query(gf,gfval,(err2, rs2)=>{          if (err){            throw err;          }          res.render('pages/lvn_pages/view_start',{ title : 'View Applicant Form', app : form_data , filez : rs2});          res.end();        });      });    });  }else{    res.redirect('/users/login');    res.end();  }});// LICENSED VOCATIONAL NURSE UPLOADER //router.post('/lvn/upload-file?',(req,res,next)=>{  var no = req.query.formid;  if(!req.files || Object.keys(req.files).length === 0){    return res.status(400).send("No files were uploaded");  }  let file = req.files.resume;  var path = 'public/files/' + file.name;  file.mv(path, (err)=>{    if(err){      console.log("error: "+ err);    }    //Save data to Database    var q = `INSERT INTO files(file_no, file_name,file_path) VALUES ?`;    var qVal = [      [no, file.name, path]    ];    con.query(q,[qVal], (err,rs)=>{      if(err){        console.log("error: "+ err);      }      res.redirect("/applicationform/lvn/startupform?formid="+ no);      res.end();    });  });});// SAVE FILL UP FORM LICENSED VOCATIONAL NURSE //router.post('/lvn/save-startappform?', function(req, res, next) {  var formid = req.query.formid;  var pg2name  = req.body.pg2name;  var pg2address = req.body.pg2address;  var pg2phonenumber = req.body.pg2phonenumber;  var pg2emailaddress = req.body.pg2emailaddress;  var pg2position = req.body.pg2position;  var form = JSON.stringify(req.body);  var query = 'INSERT INTO lvn_information (lvn_no,lvn_name,lvn_address,lvn_phonenumber,lvn_emailaddress,lvn_positionapplied,lvn_otherinfo) VALUES ?';  var queryval = [[formid,pg2name,pg2address,pg2phonenumber,pg2emailaddress,pg2position,form]];  con.query(query, [queryval], (err2, res2) => {    if (err2) {      throw err2    } else {      res.redirect('/applicationform/thankyou');    }  });});//==============================================================================================================//// MEDICAL SOCIAL WORKER ( MSW FORM )//==============================================================================================================//// FILL UP FORM FOR MEDICAL SOCIAL WORKER //router.get('/msw/startappform?',(req,res,next)=>{  if(!req.query.formid){    res.redirect('/applicationform/msw/startappform?formid='+ main.random_id());  }else{    res.render('pages/msw_pages/start', { title : 'Fillup Form', formid : req.query.formid});    res.end();  }});// VIEW MEDICAL SOCIAL WORKER FORM //router.get('/msw/viewform?',(req,res,next)=>{  if(req.session.email){    var id = req.query.id;    var q = `SELECT * FROM msw_information WHERE msw_id = ?`;    var qval = [id];    con.query(q,qval,(err,rs)=>{      if(err){        console.log("Err: "+ err);      }      var v = `UPDATE msw_information SET app_isview = ? WHERE msw_no = ?`;      var vVal = ['true', id];      con.query(v,vVal,(err1,rs1)=>{        if(err1){          console.log("Err: "+ err1);        }        var form_data = (typeof(rs[0].msw_otherinfo) === "undefined")? [] : JSON.parse(rs[0].msw_otherinfo);        var gf = `SELECT * FROM file_information WHERE file_no = ?`;        var gfval = [rs[0].msw_no];        con.query(gf,gfval,(err2, rs2)=>{          if (err){            throw err;          }          res.render('pages/msw_pages/view_start',{ title : 'View Applicant Form', app : form_data , filez : rs2});          res.end();        });      });    });  }else{    res.redirect('/users/login');    res.end();  }});// MEDICAL SOCIAL WORKER UPLOADER //router.post('/msw/upload-file?',(req,res,next)=>{  var no = req.query.formid;  if(!req.files || Object.keys(req.files).length === 0){    return res.status(400).send("No files were uploaded");  }  let file = req.files.resume;  var path = 'public/files/' + file.name;  file.mv(path, (err)=>{    if(err){      console.log("error: "+ err);    }    //Save data to Database    var q = `INSERT INTO files(file_no, file_name,file_path) VALUES ?`;    var qVal = [      [no, file.name, path]    ];    con.query(q,[qVal], (err,rs)=>{      if(err){        console.log("error: "+ err);      }      res.redirect("/applicationform/msw/startupform?formid="+ no);      res.end();    });  });});// SAVE FILL UP FORM MEDICAL SOCIAL WORKER //router.post('/msw/save-startappform?', function(req, res, next) {  var formid = req.query.formid;  var pg2name  = req.body.pg2name;  var pg2address = req.body.pg2address;  var pg2phonenumber = req.body.pg2phonenumber;  var pg2emailaddress = req.body.pg2emailaddress;  var pg2position = req.body.pg2position;  var form = JSON.stringify(req.body);  var query = 'INSERT INTO msw_information (msw_no,msw_name,msw_address,msw_phonenumber,msw_emailaddress,msw_positionapplied,msw_otherinfo) VALUES ?';  var queryval = [[formid,pg2name,pg2address,pg2phonenumber,pg2emailaddress,pg2position,form]];  con.query(query, [queryval], (err2, res2) => {    if (err2) {      throw err2    } else {      res.redirect('/applicationform/thankyou');    }  });});//==============================================================================================================//// HOME HEALTH AIDES ( HHA FORM )//==============================================================================================================//// FILL UP FORM FOR HOME HEALTH AIDES //router.get('/hha/startappform?',(req,res,next)=>{  if(!req.query.formid){    res.redirect('/applicationform/hha/startappform?formid='+ main.random_id());  }else{    res.render('pages/hha_pages/start', { title : 'Fillup Form', formid : req.query.formid});    res.end();  }});// VIEW HOME HEALTH AIDES FORM //router.get('/hha/viewform?',(req,res,next)=>{  if(req.session.email){    var id = req.query.id;    var q = `SELECT * FROM hha_information WHERE hha_id = ?`;    var qval = [id];    con.query(q,qval,(err,rs)=>{      if(err){        console.log("Err: "+ err);      }      var v = `UPDATE hha_information SET app_isview = ? WHERE hha_no = ?`;      var vVal = ['true', id];      con.query(v,vVal,(err1,rs1)=>{        if(err1){          console.log("Err: "+ err1);        }        var form_data = (typeof(rs[0].hha_otherinfo) === "undefined")? [] : JSON.parse(rs[0].hha_otherinfo);        var gf = `SELECT * FROM file_information WHERE file_no = ?`;        var gfval = [rs[0].hha_no];        con.query(gf,gfval,(err2, rs2)=>{          if (err){            throw err;          }          res.render('pages/hha_pages/view_start',{ title : 'View Applicant Form', app : form_data , filez : rs2});          res.end();        });      });    });  }else{    res.redirect('/users/login');    res.end();  }});// HOME HEALTH AIDES UPLOADER //router.post('/hha/upload-file?',(req,res,next)=>{  var no = req.query.formid;  if(!req.files || Object.keys(req.files).length === 0){    return res.status(400).send("No files were uploaded");  }  let file = req.files.resume;  var path = 'public/files/' + file.name;  file.mv(path, (err)=>{    if(err){      console.log("error: "+ err);    }    //Save data to Database    var q = `INSERT INTO files(file_no, file_name,file_path) VALUES ?`;    var qVal = [      [no, file.name, path]    ];    con.query(q,[qVal], (err,rs)=>{      if(err){        console.log("error: "+ err);      }      res.redirect("/applicationform/hha/startupform?formid="+ no);      res.end();    });  });});// SAVE FILL UP FORM HOME HEALTH AIDES //router.post('/hha/save-startappform?', function(req, res, next) {  var formid = req.query.formid;  var pg2name  = req.body.pg2name;  var pg2address = req.body.pg2address;  var pg2phonenumber = req.body.pg2phonenumber;  var pg2emailaddress = req.body.pg2emailaddress;  var pg2position = req.body.pg2position;  var form = JSON.stringify(req.body);  var query = 'INSERT INTO hha_information (hha_no,hha_name,hha_address,hha_phonenumber,hha_emailaddress,hha_positionapplied,hha_otherinfo) VALUES ?';  var queryval = [[formid,pg2name,pg2address,pg2phonenumber,pg2emailaddress,pg2position,form]];  con.query(query, [queryval], (err2, res2) => {    if (err2) {      throw err2    } else {      res.redirect('/applicationform/thankyou');    }  });});//==============================================================================================================//// SPIRITUAL COUNSELOR ( SC FORM )//==============================================================================================================//// FILL UP FORM FOR SPIRITUAL COUNSELOR //router.get('/sc/startappform?',(req,res,next)=>{  if(!req.query.formid){    res.redirect('/applicationform/sc/startappform?formid='+ main.random_id());  }else{    res.render('pages/sc_pages/start', { title : 'Fillup Form', formid : req.query.formid});    res.end();  }});// VIEW SPIRITUAL COUNSELOR FORM //router.get('/sc/viewform?',(req,res,next)=>{  if(req.session.email){    var id = req.query.id;    var q = `SELECT * FROM sc_information WHERE sc_id = ?`;    var qval = [id];    con.query(q,qval,(err,rs)=>{      if(err){        console.log("Err: "+ err);      }      var v = `UPDATE sc_information SET app_isview = ? WHERE sc_no = ?`;      var vVal = ['true', id];      con.query(v,vVal,(err1,rs1)=>{        if(err1){          console.log("Err: "+ err1);        }        var form_data = (typeof(rs[0].sc_otherinfo) === "undefined")? [] : JSON.parse(rs[0].sc_otherinfo);        var gf = `SELECT * FROM file_information WHERE file_no = ?`;        var gfval = [rs[0].sc_no];        con.query(gf,gfval,(err2, rs2)=>{          if (err){            throw err;          }          res.render('pages/sc_pages/view_start',{ title : 'View Applicant Form', app : form_data , filez : rs2});          res.end();        });      });    });  }else{    res.redirect('/users/login');    res.end();  }});// SPIRITUAL COUNSELOR UPLOADER //router.post('/sc/upload-file?',(req,res,next)=>{  var no = req.query.formid;  if(!req.files || Object.keys(req.files).length === 0){    return res.status(400).send("No files were uploaded");  }  let file = req.files.resume;  var path = 'public/files/' + file.name;  file.mv(path, (err)=>{    if(err){      console.log("error: "+ err);    }    //Save data to Database    var q = `INSERT INTO files(file_no, file_name,file_path) VALUES ?`;    var qVal = [      [no, file.name, path]    ];    con.query(q,[qVal], (err,rs)=>{      if(err){        console.log("error: "+ err);      }      res.redirect("/applicationform/sc/startupform?formid="+ no);      res.end();    });  });});// SAVE FILL UP FORM SPIRITUAL COUNSELOR //router.post('/sc/save-startappform?', function(req, res, next) {  var formid = req.query.formid;  var pg2name  = req.body.pg2name;  var pg2address = req.body.pg2address;  var pg2phonenumber = req.body.pg2phonenumber;  var pg2emailaddress = req.body.pg2emailaddress;  var pg2position = req.body.pg2position;  var form = JSON.stringify(req.body);  var query = 'INSERT INTO sc_information (sc_no,sc_name,sc_address,sc_phonenumber,sc_emailaddress,sc_positionapplied,sc_otherinfo) VALUES ?';  var queryval = [[formid,pg2name,pg2address,pg2phonenumber,pg2emailaddress,pg2position,form]];  con.query(query, [queryval], (err2, res2) => {    if (err2) {      throw err2    } else {      res.redirect('/applicationform/thankyou');    }  });});module.exports = router;